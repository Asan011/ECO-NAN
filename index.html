<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Эко-Нан — пекарня</title>
  <meta name="description" content="Эко-Нан — свежий хлеб и пирожные. Онлайн-меню, корзина и заявка." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root{
      --bg:#fafafa;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --brand:#3cae36;
      --brand-dark:#2a8b26;
      --accent:#b37b47;
      --accent-strong:#f59e0b;
      --ring: rgba(60,174,54,0.35);
      --shadow: 0 10px 20px rgba(0,0,0,.06), 0 6px 6px rgba(0,0,0,.04);
      --radius: 18px;
      --modal-max: 880px;
      /* footer */
      --footer-contrast-1: #0b4724;
      --footer-contrast-2: #135f32;
      --footer-text: #f7fff7;
      --footer-accent: #dff7e6;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{width:min(1200px,92%);margin-inline:auto}

    /* Header */
    header{position:sticky;top:0;z-index:60;background:rgba(255,255,255,.95);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid #eee}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:.8rem 0}
    .nav-left{display:flex;gap:1rem;align-items:center}
    .logo{display:flex;align-items:center;gap:.6rem;font-weight:700}
    .logo img{width:36px;height:36px;border-radius:50%}
    .nav-links{display:flex;gap:.2rem}
    .nav-links a{padding:.5rem .9rem;border-radius:12px;transition:.2s}
    .nav-links a:hover{background:#f3f4f6}
    .actions{display:flex;gap:.6rem;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.7rem 1rem;border-radius:12px;border:1px solid #e5e7eb;background:var(--card);box-shadow:var(--shadow);cursor:pointer;transition:.18s}
    .btn:hover{transform:translateY(-1px)}
    .btn-primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn-primary:hover{background:var(--brand-dark)}
    select.lang{padding:.6rem .9rem;border-radius:12px;border:1px solid #e5e7eb;background:var(--card)}
    .btn.icon{width:44px;height:44px;padding:0;font-size:20px}

    /* Hero */
    .hero{position:relative;isolation:isolate}
    .hero .wrap{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;align-items:center;padding:3rem 0}
    .pill{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .7rem;border-radius:999px;background:#ecfdf5;color:#065f46;font-weight:600;font-size:.85rem}
    .headline{font-size:clamp(2rem,4.5vw,3.2rem);line-height:1.1;margin:.6rem 0 1rem}
    .sub{color:var(--muted);font-size:1.05rem}
    .hero-card{background:radial-gradient(1200px 400px at -10% -10%, #e6f7e5 0, transparent 60%), var(--card);padding:2rem;border-radius:var(--radius);box-shadow:var(--shadow)}
    .hero img{border-radius:var(--radius)}

    /* Section */
    section{padding:3rem 0}
    .section-title{display:flex;align-items:end;justify-content:space-between;margin-bottom:1.4rem}
    .section-title h2{font-size:clamp(1.4rem,2.8vw,2rem);margin:0}
    .muted{color:var(--muted)}

    /* Menu grid */
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.1rem}
    @media (max-width: 1024px){.hero .wrap{grid-template-columns:1fr}.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 560px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;position:relative}
    .card img{width:100%;height:220px;object-fit:cover;display:block}
    .card-body{padding:1rem;display:flex;flex-direction:column;gap:.6rem}
    .title{font-weight:600}
    .price{font-weight:700;color:var(--accent)}
    .card-footer{display:flex;align-items:center;justify-content:space-between;gap:.6rem}
    .add-btn{min-width:84px;padding:.38rem .5rem;border-radius:10px;font-size:.92rem;line-height:1;white-space:nowrap;display:inline-flex;align-items:center;gap:.45rem}
    .btn-compo{padding:.36rem .6rem;border-radius:10px;font-size:.88rem;white-space:nowrap;background: linear-gradient(180deg,var(--accent-strong), #d97706);color:#fff;border:none;box-shadow: 0 8px 20px rgba(245,158,11,0.18)}
    .muted-small{color:var(--muted);font-size:.95rem}

    /* Cart drawer */
    .cart-btn{position:relative}
    .badge{position:absolute;top:-6px;right:-6px;background:var(--brand);color:#fff;border-radius:999px;padding:.1rem .45rem;font-size:.75rem;font-weight:700}
    .drawer{position:fixed;inset:0;display:none;z-index:70}
    .drawer[aria-open="true"]{display:block}
    .drawer .overlay{position:absolute;inset:0;background:rgba(0,0,0,.35)}
    .drawer .panel{position:absolute;top:0;right:0;height:100%;width:min(520px,92%);background:#fff;box-shadow: -8px 0 24px rgba(0,0,0,.12);display:flex;flex-direction:column}
    .panel header{position:sticky;top:0;border-bottom:1px solid #eee;background:#fff;display:flex;align-items:center;justify-content:space-between;padding:.8rem 1rem}
    .panel .content{padding:1rem;flex:1;overflow:auto}
    .cart-item{display:grid;grid-template-columns:64px 1fr auto;gap:.8rem;align-items:center;padding:.6rem 0;border-bottom:1px dashed #eee}
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:12px}
    .cart-item .name{font-weight:600}
    .panel footer{padding:1rem;border-top:1px solid #eee}

    /* Mobile NAV drawer */
    .drawer.navdrawer .panel{width:min(360px,92%)}
    .drawer.navdrawer .content a{display:block;padding:.9rem 1rem;border-radius:12px;margin:.2rem 0}
    .drawer.navdrawer .content a:hover{background:#f3f4f6}

    /* Checkout */
    .form{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .form .full{grid-column:1/-1}
    .field{display:flex;flex-direction:column;gap:.4rem}
    .input, .select, textarea{padding:.75rem .9rem;border:1px solid #e5e7eb;border-radius:12px;background:#fff}
    textarea{min-height:100px}
    .pay{display:flex;gap:.7rem;flex-wrap:wrap}
    .chip{display:flex;align-items:center;gap:.45rem;border:1px solid #e5e7eb;border-radius:999px;padding:.5rem .8rem;background:#fff;cursor:pointer}
    .chip input{accent-color:var(--brand)}

    /* Footer */
    footer.site-footer{
      background: linear-gradient(90deg, var(--footer-contrast-1), var(--footer-contrast-2));
      color:var(--footer-text);
      padding:28px 0;
      margin-top:24px;
      border-top: 4px solid rgba(255,255,255,0.03);
    }
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;max-width:1200px;margin-inline:auto;padding:0 16px}
    .footer-left{display:flex;align-items:center;gap:12px}
    .footer-left .badge{width:56px;height:56px;border-radius:12px;background:linear-gradient(180deg,#dff7e6,#bfeed0);display:flex;align-items:center;justify-content:center;color:var(--footer-contrast-1);font-weight:800;font-size:20px}
    .footer-left .meta{display:flex;flex-direction:column}
    .footer-left .meta .title{font-weight:700;color:var(--footer-text);font-size:1.05rem}
    .footer-left .meta .tag{color:var(--footer-accent);font-size:.95rem;margin-top:4px}
    .footer-center{display:flex;align-items:center;gap:14px;flex-direction:column}
    .hours-card{background: rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;min-width:220px;box-shadow: 0 6px 18px rgba(0,0,0,0.12)}
    .hours-card .h-title{font-weight:700;color:var(--footer-text);margin-bottom:6px}
    .hours-card .h-line{color:var(--footer-accent);font-size:.98rem}
    .footer-right{display:flex;align-items:center;gap:12px}
    .social-icon{width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.08);display:inline-flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.06)}
    .social-icon svg{width:18px;height:18px;display:block}
    .footer-bottom{margin-top:16px;color:rgba(255,255,255,0.85);font-size:.95rem;display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap;padding:0 16px}
    .footer-bottom .left{color:rgba(255,255,255,0.88)}
    .footer-bottom .right{color:rgba(255,255,255,0.7)}

    @media (max-width:720px){
      .footer-inner{flex-direction:column;align-items:flex-start}
      .footer-right{margin-top:6px}
      .footer-center{align-items:flex-start;width:100%}
      .hours-card{min-width:100%}
    }

    /* Modal */
    .modal{display:none;position:fixed;inset:0;z-index:200;pointer-events:none}
    .modal[aria-open="true"]{display:block;pointer-events:auto}
    .modal .overlay{position:absolute;inset:0;background:linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.45));backdrop-filter:blur(2px)}
    .modal .dialog{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.98);width:min(var(--modal-max),92%);max-height:86vh;background:var(--card);border-radius:14px;box-shadow:0 20px 40px rgba(0,0,0,.25);overflow:auto;display:flex;gap:1rem;padding:1rem;opacity:0;transition:opacity .22s ease, transform .22s ease}
    .modal[aria-open="true"] .dialog{opacity:1;transform:translate(-50%,-50%) scale(1)}
    .modal .dialog .img{flex:0 0 220px; border-radius:10px; overflow:hidden;box-shadow: 0 6px 18px rgba(0,0,0,.08)}
    .modal .dialog .img img{width:220px;height:170px;object-fit:cover;display:block}
    .modal .dialog .body{padding:.3rem .6rem;flex:1;display:flex;flex-direction:column}
    .modal .dialog h3{margin:0 0 .45rem;font-size:1.15rem}
    .modal .dialog .desc{color:var(--muted);line-height:1.5;margin-bottom:.8rem}
    .modal .actions{margin-top:auto;display:flex;gap:.6rem;align-items:center}
    .modal .close-btn{position:absolute;right:12px;top:12px;border-radius:8px;border:1px solid #eee;padding:.3rem .5rem;background:#fff;cursor:pointer}
    @media (max-width:560px){
      .modal .dialog{left:50%;top:auto;bottom:0;transform:translateX(-50%);width:100%;height:62vh;border-radius:12px 12px 0 0;padding:0.6rem 0.6rem 1rem;display:flex;flex-direction:column}
      .modal .dialog .img{flex:0 0 auto}
      .modal .dialog .img img{width:100%;height:150px;object-fit:cover}
      .modal .dialog .body{padding:.6rem}
      .modal .close-btn{right:14px;top:8px}
    }

  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container nav">
      <div class="nav-left">
        <a href="#home" class="logo" aria-label="Эко-Нан — домой">
          <img src="ChatGPT Image 15 авг. 2025 г., 20_07_36.png" alt="Эко-Нан логотип" onerror="this.style.display='none'" />
          <span style="color: #2a8b26;">Эко-Нан</span>
        </a>
        <nav class="nav-links" aria-label="Главная навигация">
          <a href="#home" data-i18n="nav.home">Главная</a>
          <a href="#menu" data-i18n="nav.menu">Меню</a>
          <a href="#contacts" data-i18n="nav.contacts">Адреса</a>
        </nav>
      </div>

      <div class="actions" role="toolbar" aria-label="Действия">
        <button class="btn cart-btn" id="openCart" aria-label="Открыть корзину">
          🧺 <span data-i18n="ui.cart">Корзина</span>
          <span class="badge" id="cartCount">0</span>
        </button>

        <button class="btn icon" id="openNav" aria-label="Открыть меню">☰</button>

        <select class="lang" id="lang" aria-label="Выбор языка">
          <option value="ru">RU</option>
          <option value="ky">KG</option>
          <option value="en">EN</option>
        </select>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section id="home" class="hero">
    <div class="container wrap">
      <div class="hero-card reveal">
        <span class="pill" data-i18n="hero.pill">Каждый день — свежая выпечка</span>
        <h1 class="headline" data-i18n="hero.title">Натуральный домашний хлеб на закваске</h1>
        <p class="sub" data-i18n="hero.text">Выбирайте любимую выпечку онлайн</p>
        <div style="margin-top:1rem;display:flex;gap:.6rem;flex-wrap:wrap">
          <a href="#menu" class="btn btn-primary" data-i18n="hero.cta">Смотреть меню</a>
          <a href="#contacts" class="btn" data-i18n="hero.cta2">Адреса</a>
        </div>
      </div>
      <div class="reveal">
        <img src="https://images.unsplash.com/photo-1549931319-a545dcf3bc73?q=80&w=1400&auto=format&fit=crop" alt="Свежий хлеб">
      </div>
    </div>
  </section>

  <!-- Menu -->
  <section id="menu">
    <div class="container">
      <div class="section-title">
        <h2 data-i18n="menu.title">Меню</h2>
      </div>
      <div class="grid" id="menuGrid" aria-live="polite"></div>
    </div>
  </section>

  <!-- Checkout -->
  <section id="checkout">
    <div class="container">
      <div class="section-title">
        <h2 data-i18n="checkout.title">Оформление заказа</h2>
        <span class="muted" data-i18n="checkout.subtitle">Заполните контактные данные и способ оплаты</span>
      </div>
      <form id="orderForm" class="form">
        <div class="field">
          <label for="name" data-i18n="form.name">Ваше имя</label>
          <input id="name" class="input" required />
        </div>
        <div class="field">
          <label for="phone" data-i18n="form.phone">Телефон</label>
          <input id="phone" class="input" required />
        </div>
        <div class="field full">
          <label for="address" data-i18n="form.address">Адрес (доставка) или отметьте самовывоз</label>
          <input id="address" class="input" />
        </div>
        <div class="field full">
          <span class="muted" data-i18n="form.paytitle">Способ оплаты</span>
          <div class="pay">
            <label class="chip"><input type="radio" name="pay" value="MBank" checked/> MBank</label>
            <label class="chip"><input type="radio" name="pay" value="Optima"/> Optima</label>
            <label class="chip"><input type="radio" name="pay" value="Cash"/> Наличные при получении</label>
          </div>
        </div>
        <div class="field full">
          <label for="comment" data-i18n="form.comment">Комментарий</label>
          <textarea id="comment"></textarea>
        </div>
        <div class="field full">
          <button type="submit" class="btn btn-primary" style="width:100%" data-i18n="form.submit">Отправить заявку</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Contacts / Map -->
  <section id="contacts">
    <div class="container">
      <div class="section-title">
        <h2 data-i18n="contacts.title">Адреса</h2>
        <span class="muted" data-i18n="contacts.subtitle">Наши магазины на карте</span>
      </div>

      <div id="map" class="reveal" aria-hidden="false" style="height:460px;border-radius:18px;overflow:hidden;box-shadow:var(--shadow)"></div>

      <div style="margin-top:1rem" class="muted">
        <details>
          <summary>Показать список адресов</summary>
          <ul id="addrList" style="margin-top:.5rem"></ul>
        </details>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-left">
        <div class="badge">Э</div>
        <div class="meta">
          <div class="title">Эко-Нан</div>
          <div class="tag">Натуральная выпечка каждый день</div>
        </div>
      </div>

      <div class="footer-center" aria-hidden="false">
        <div class="hours-card" role="note" aria-label="Часы работы">
          <div class="h-title">Часы работы</div>
          <div class="h-line">Пн — Вс: 07:00 — 21:00</div>
          <div class="h-line" style="font-size:.88rem;color:rgba(255,255,255,0.9);margin-top:6px">Работаем без выходных</div>
        </div>
      </div>

      <div class="footer-right" aria-hidden="false">
        <a class="social-icon" href="https://wa.me/996507200015" target="_blank" rel="noopener" title="WhatsApp">
          <!-- WhatsApp icon -->
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M20.52 3.48A11.92 11.92 0 0012 0C5.373 0 .005 5.373 0 12.01 0 13.98.48 15.86 1.39 17.53L.02 23.7l6.42-1.68A11.93 11.93 0 0012 24c6.627 0 12.03-5.373 12.03-12.01 0-3.2-1.25-6.2-3.51-8.31z" fill="#25D366"/>
            <path d="M17.54 14.63c-.29-.14-1.71-.84-1.98-.94-.27-.1-.47-.14-.67.14-.2.29-.77.94-.95 1.13-.18.2-.36.23-.67.08-.31-.14-1.32-.49-2.51-1.54-.93-.83-1.56-1.86-1.74-2.17-.18-.31-.02-.48.13-.63.14-.14.31-.36.47-.54.16-.18.21-.3.31-.5.1-.2.05-.37-.02-.51-.07-.14-.67-1.61-.92-2.21-.24-.58-.49-.5-.67-.51-.18-.01-.39-.01-.59-.01s-.51.07-.78.37c-.27.29-1.05 1.03-1.05 2.51s1.08 2.92 1.23 3.13c.14.2 2.12 3.24 5.13 4.54 3.01 1.3 3.01.87 3.56.81.55-.06 1.75-.71 1.99-1.4.24-.69.24-1.28.17-1.4-.07-.12-.27-.18-.56-.32z" fill="#fff"/>
          </svg>
        </a>

        <a class="social-icon" href="https://www.instagram.com/eco__nan" target="_blank" rel="noopener" title="Instagram">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <linearGradient id="igGradFooter" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#f58529"/>
              <stop offset="0.5" stop-color="#dd2a7b"/>
              <stop offset="1" stop-color="#8134af"/>
            </linearGradient>
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5" fill="url(#igGradFooter)"/>
            <path d="M12 7.3a4.7 4.7 0 100 9.4 4.7 4.7 0 000-9.4z" fill="#fff"/>
            <circle cx="17.8" cy="6.2" r="1.1" fill="#fff"/>
          </svg>
        </a>

        <a class="social-icon" href="tel:+996507200015" title="Позвонить">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M21 16.5v3a1.5 1.5 0 01-1.65 1.49 19.48 19.48 0 01-8.24-3.02A19.5 19.5 0 013.51 6.65 19.48 19.48 0 01 6.5 2.65 1.5 1.5 0 018 1h3a1.5 1.5 0 011.5 1.2l.6 3a1.5 1.5 0 01-.45 1.37l-1.2 1a14.94 14.94 0 006.02 6.02l1-1.2a1.5 1.5 0 011.37-.45l3 .6A1.5 1.5 0 0124 16v0a1.5 1.5 0 01-1 0.5z" fill="#fff"/>
          </svg>
        </a>
      </div>

    <div class="footer-bottom">
      <div class="left">© <span id="year"></span> Эко-Нан</div>
      <div class="right" aria-hidden="true">Адреса — в разделе «Адреса» и на карте</div>
    </div>
  </footer>

  <!-- Cart Drawer -->
  <div class="drawer" id="drawer" aria-open="false" aria-hidden="true">
    <div class="overlay" id="closeCart"></div>
    <div class="panel" role="dialog" aria-label="Корзина">
      <header class="nav">
        <div style="font-weight:700">🧺 <span data-i18n="ui.cart">Корзина</span></div>
        <button class="btn" id="xClose" aria-label="Закрыть корзину">✕</button>
      </header>
      <div class="content" id="cartItems" tabindex="0"></div>
      <footer>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.8rem">
          <div class="muted" data-i18n="cart.total">Итого</div>
          <div style="font-weight:800" id="cartTotal">0 KGS</div>
        </div>
        <div style="display:flex;gap:.6rem;flex-wrap:wrap">
          <a href="#checkout" class="btn btn-primary" id="toCheckout" data-i18n="cart.checkout">Перейти к оформлению</a>
          <button class="btn" id="clearCart" data-i18n="cart.clear">Очистить</button>
        </div>
      </footer>
    </div>
  </div>

  <!-- Mobile NAV Drawer -->
  <div class="drawer navdrawer" id="navDrawer" aria-open="false" aria-hidden="true">
    <div class="overlay" id="closeNav"></div>
    <div class="panel" role="dialog" aria-label="Мобильное меню">
      <header class="nav">
        <div style="font-weight:700">Меню</div>
        <button class="btn" id="xNav" aria-label="Закрыть меню">✕</button>
      </header>
      <div class="content">
        <a href="#home" data-i18n="nav.home" class="mnav">Главная</a>
        <a href="#menu" data-i18n="nav.menu" class="mnav">Меню</a>
        <a href="#contacts" data-i18n="nav.contacts" class="mnav">Адреса</a>
        <div style="height:1px;background:#eee;margin:1rem 0"></div>
        <div class="field">
          <label for="langMobile" class="muted" data-i18n="ui.lang">Язык</label>
          <select class="input" id="langMobile">
            <option value="ru">RU</option>
            <option value="ky">KG</option>
            <option value="en">EN</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for composition -->
  <div class="modal" id="modal" aria-open="false" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="overlay" id="modalOverlay"></div>
    <div class="dialog" role="document" aria-labelledby="modalTitle">
      <button class="close-btn" id="modalClose" aria-label="Закрыть">✕</button>
      <div class="img"><img id="modalImg" src="" alt=""></div>
      <div class="body">
        <h3 id="modalTitle"></h3>
        <div class="desc" id="modalDesc"></div>
        <div class="actions">
          <button class="btn btn-primary" id="modalAdd">В корзину</button>
          <button class="btn" id="modalCloseBtn">Закрыть</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ===== Helpers
    const $ = (s, p=document) => p.querySelector(s);
    const $$ = (s, p=document) => p.querySelectorAll(s);
    const fmt = (n) => new Intl.NumberFormat('ru-KG', {style:'currency', currency:'KGS', maximumFractionDigits:0}).format(n);

    // ===== I18N (как в предыдущем коде) =====
    const i18n = {
      ru: {
        'nav.home':'Главная','nav.menu':'Меню','nav.contacts':'Адреса',
        'ui.lang':'Язык','ui.cart':'Корзина',
        'hero.pill':'Каждый день — свежая выпечка',
        'hero.title':'Натуральный домашний хлеб на закваске',
        'hero.text':'Выбирайте любимую выпечку онлайн',
        'hero.cta':'Смотреть меню','hero.cta2':'Адреса',
        'menu.title':'Меню','checkout.title':'Оформление заказа','checkout.subtitle':'Заполните контактные данные и способ оплаты',
        'form.name':'Ваше имя','form.phone':'Телефон','form.address':'Адрес (доставка) или отметьте самовывоз',
        'form.paytitle':'Способ оплаты','form.comment':'Комментарий',
        'form.submit':'Отправить заявку',
        'form.namePlaceholder':'Имя','form.phonePlaceholder':'+996 000 000 000','form.addressPlaceholder':'Ваш адрес','form.commentPlaceholder':'Комментарий',
        'contacts.title':'Адреса','contacts.subtitle':'Наши магазины на карте','footer.txt':'Свежая выпечка каждый день.',
        'cart.total':'Итого','cart.checkout':'Перейти к оформлению','cart.clear':'Очистить',
        'ui.add':'В корзину','ui.ingredients':'Состав'
      },
      ky: {
        'nav.home':'Башкы бет','nav.menu':'Меню','nav.contacts':'Даректер',
        'ui.lang':'Тил','ui.cart':'Себет',
        'hero.pill':'Күн сайын — жаңы бышкан нан',
        'hero.title':'Табигый үй нан — ачыткы менен',
        'hero.text':'Сүйгөн даамыңды онлайн тандаңыз',
        'hero.cta':'Менюну көрүү','hero.cta2':'Даректер',
        'menu.title':'Меню','checkout.title':'Заказды оформлениялоо','checkout.subtitle':'Байланыш жана төлөм ыкмасын толтуруңуз',
        'form.name':'Атыңыз','form.phone':'Телефон','form.address':'Дарек (жеткирүү) же өзүң алып кетүү',
        'form.paytitle':'Төлөм ыкмасы','form.comment':'Комментарий',
        'form.submit':'Буйрутма жөнөтүңүз',
        'form.namePlaceholder':'Ат','form.phonePlaceholder':'+996 000 000 000','form.addressPlaceholder':'Сиздин дарегиңиз','form.commentPlaceholder':'Комментарий',
        'contacts.title':'Даректер','contacts.subtitle':'Дүкөндөр картада','footer.txt':'Күн сайын жаңы нан.',
        'cart.total':'Жалпы','cart.checkout':'Оформлениялоого өтүү','cart.clear':'Тазалоо',
        'ui.add':'Себетке','ui.ingredients':'Курамы'
      },
      en: {
        'nav.home':'Home','nav.menu':'Menu','nav.contacts':'Addresses',
        'ui.lang':'Language','ui.cart':'Cart',
        'hero.pill':'Freshly baked daily',
        'hero.title':'Natural homemade sourdough bread',
        'hero.text':'Choose your favorite bakes online',
        'hero.cta':'View menu','hero.cta2':'Addresses',
        'menu.title':'Menu','checkout.title':'Checkout','checkout.subtitle':'Fill in your contacts and payment method',
        'form.name':'Your name','form.phone':'Phone','form.address':'Address (delivery) or pickup',
        'form.paytitle':'Payment method','form.comment':'Comment',
        'form.submit':'Send order',
        'form.namePlaceholder':'Name','form.phonePlaceholder':'+996 000 000 000','form.addressPlaceholder':'Your address','form.commentPlaceholder':'Comment',
        'contacts.title':'Addresses','contacts.subtitle':'Our shops on the map','footer.txt':'Fresh bakes every day.',
        'cart.total':'Total','cart.checkout':'Go to checkout','cart.clear':'Clear',
        'ui.add':'Add to cart','ui.ingredients':'Ingredients'
      }
    };

    function setLang(lang){
      const dict = i18n[lang] || i18n.ru;
      for (const el of $$('[data-i18n]')) {
        const key = el.getAttribute('data-i18n');
        if (dict[key]) el.textContent = dict[key];
      }
      // placeholders
      const nameEl = $('#name'); if(nameEl) nameEl.placeholder = dict['form.namePlaceholder'] || '';
      const phoneEl = $('#phone'); if(phoneEl) phoneEl.placeholder = dict['form.phonePlaceholder'] || '';
      const addrEl = $('#address'); if(addrEl) addrEl.placeholder = dict['form.addressPlaceholder'] || '';
      const commEl = $('#comment'); if(commEl) commEl.placeholder = dict['form.commentPlaceholder'] || '';
      document.documentElement.lang = lang;
      const s1 = $('#lang'); if(s1) s1.value = lang;
      const s2 = $('#langMobile'); if(s2) s2.value = lang;
      renderMenu();
      renderCart();
    }
    $('#lang')?.addEventListener('change', e=> setLang(e.target.value));
    document.addEventListener('change', (e)=>{ if(e.target && e.target.id==='langMobile') setLang(e.target.value); });

    // ===== Products (ваши товары — оставил ваши имена и составы) =====
    const P = [
      {id:1, name:{ky:'Таш тегирмен',ru:'Таш тегирмен',en:'Tash Tegirmen'}, price:100, img:'images/tash2.jpeg', comp:{ky:'450 г\nКурамы: Табигый ачыткы, таш тегирмен буудай уну, суу, туз',ru:'450 г\nСостав: Натуральная закваска, цельнозерновая каменная пшеничная мука, вода, соль',en:'450 g\nIngredients: Natural sourdough starter, wholegrain stone-milled wheat flour, water, salt'}},
      {id:2, name:{ky:'Гречневый',ru:'Гречневый',en:'Buckwheat loaf'}, price:110, img:'images/grechka.jpeg', comp:{ky:'350 г\nКурамы: Табигый ачыткы, буудай уну, гречка уну, суу, туз',ru:'350 г\nСостав: Натуральная закваска, пшеничная мука, гречневая мука, вода, соль',en:'350 g\nIngredients: Natural sourdough starter, wheat flour, buckwheat flour, water, salt'}},
      {id:3, name:{ky:'Тартин классический',ru:'Тартин классический',en:'Classic Tartine'}, price:100, img:'images/tartin.jpeg', comp:{ky:'450 г\nКурамы: Табигый ачыткы, буудай уну, суу, туз',ru:'450 г\nСостав: Натуральная закваска, пшеничная мука, вода, соль',en:'450 g\nIngredients: Natural sourdough starter, wheat flour, water, salt'}},
      {id:4, name:{ky:'Сухари гречневые',ru:'Сухари гречневые',en:'Buckwheat rusks'}, price:100, img:'images/suhari.jpeg', comp:{ky:'300 г\nКурамы: Табигый ачыткы, таш тегирмен буудай уну, суу, туз',ru:'300 г\nСостав: Натуральная закваска, цельнозерновая каменная мука, вода, соль',en:'300 g\nIngredients: Natural sourdough starter, wholegrain stone-milled flour, water, salt'}},

      {id:5, name:{ky:'Булочка с маком',ru:'Булочка с маком',en:'Poppy-seed bun'}, price:450, img:'images/mac.jpeg', comp:{ky:'Булочка менен макак. Ванильдуу творог жана үй сүтү.',ru:'С ванильным творогом и домашним молоком.',en:'With vanilla curd and homemade milk.'}},
      {id:6, name:{ky:'Самсушки с курагой',ru:'Самсушки с курагой',en:'Samsa with dried apricots'}, price:450, img:'images/samsy.jpeg', comp:{ky:'На сливочном майда, сметана жана табигый курага менен.',ru:'На сливочном масле, со сметаной и натуральной курагой.',en:'Made with butter, served with sour cream and dried apricots.'}},
      {id:7, name:{ky:'Сочинские',ru:'Сочинские',en:'Sochi pastries'}, price:450, img:'images/sochi.jpeg', comp:{ky:'Табигый ванильдуу творог, сметана жана сливочтук май менен.',ru:'С натуральным ванильным творогом, со сметаной и сливочным маслом.',en:'With natural vanilla curd, sour cream and butter.'}},
      {id:8, name:{ky:'Кекс шоколадный',ru:'Кекс шоколадный',en:'Chocolate cupcake'}, price:450, img:'images/chokokeks.jpeg', comp:{ky:'Бардык ингредиенттер табигый. Консервантар жана боёктар жок.',ru:'Все ингредиенты натуральные. Без консервантов, без красителей.',en:'All ingredients are natural. No preservatives, no artificial colors.'}},
      {id:9, name:{ky:'Кекс классический',ru:'Кекс классический',en:'Classic cupcake'}, price:450, img:'images/klasickeks.jpeg', comp:{ky:'Бардык ингредиенттер табигый. Консервантар жана боёктар жок.',ru:'Все ингредиенты натуральные. Без консервантов, без красителей.',en:'All ingredients are natural. No preservatives, no artificial colors.'}},
      {id:10,name:{ky:'Творожные рогалики',ru:'Творожные рогалики',en:'Cottage cheese croissants'}, price:450, img:'images/roga.jpeg', comp:{ky:'Сметана жана сливочтук май менен. Боёк жана маргарин жок.',ru:'Со сметаной и со сливочным маслом. Без красителей и без маргарина.',en:'Made with sour cream and butter. No artificial colors and no margarine.'}},
      {id:11,name:{ky:'Профитроли с заварным кремом',ru:'Профитроли с заварным кремом',en:'Profiteroles with custard'}, price:450, img:'images/prof.jpeg', comp:{ky:'Бардык ингредиенттер табигый.',ru:'Все ингредиенты натуральные.',en:'All ingredients are natural.'}},
      {id:12,name:{ky:'Муравейник',ru:'Муравейник',en:'Muraveynik (Ant-hill cake)'}, price:450, img:'images/muravei.jpeg', comp:{ky:'На сливочтук май, сметана жана сгущенка менен.',ru:'На сливочном масле. Со сметаной и со сгущённым молоком.',en:'Made with butter. With sour cream and condensed milk.'}},

      {id:13, name:{ky:'Муздатылган камыр',ru:'Замороженное тесто',en:'Frozen dough'}, price:200, img:'images/testo.jpeg', comp:{ky:'500 г\nКурамы: Муздатылган камыр — бүтүндөй дан уну жана ачыткы менен, нан, боорсок, пирожок үчүн',ru:'500 г\nСостав: Замороженное тесто из цельнозерновой муки с закваской для хлеба, боорсока, пирожков',en:'500 g\nIngredients: Frozen dough from wholegrain flour with sourdough starter — for bread, boorsok, pirozhki'}},
      {id:14, name:{ky:'Кургак ачыткы 60 г',ru:'Сухая закваска 60 г',en:'Dry starter 60 g'}, price:200, img:'images/zakvaska.jpeg', comp:{ky:'60 г\nКурамы: ун, суу\nСактоо мөөнөтү: 3 жыл\nСипаттамасы: Табигый ачыткы, цельнозернова ун, суу, туз',ru:'60 г\nСостав: мука, вода\nСрок хранения: 3 года\nОписание: Натуральная закваска, цельнозерновая мельничная мука, вода, соль',en:'60 g\nIngredients: flour, water\nShelf life: 3 years\nDetails: Natural sourdough starter, wholegrain milled flour, water, salt'}}
    ];

    // ===== Render menu (карточки: показываем только граммы на карточке; состав — в модальном) =====
    const grid = $('#menuGrid');
    function renderMenu(){
      if(!grid) return;
      grid.innerHTML = '';
      const lang = document.documentElement.lang || 'ru';
      for(const p of P){
        const card = document.createElement('div');
        card.className = 'card reveal';
        let weightLine = '';
        if(p.comp && p.comp[lang]) {
          const lines = p.comp[lang].split('\n').map(s=>s.trim()).filter(Boolean);
          if(lines.length && /^\d+\s?г/i.test(lines[0])) weightLine = lines[0];
        }
        card.innerHTML = `
          <img src="${p.img}" alt="${p.name[lang]}" loading="lazy" />
          <div class="card-body">
            <div class="title">${p.name[lang]}</div>
            <div class="muted-small">${weightLine}</div>
            <div class="card-footer" style="margin-top:.6rem">
              <div class="price">${fmt(p.price)}</div>
              <div class="actions" style="display:flex;gap:.5rem;align-items:center">
                <button class="btn-compo" data-ingredients="${p.id}">${i18n[lang]['ui.ingredients']}</button>
                <button class="btn btn-primary add-btn" data-add="${p.id}">+ <span>${i18n[lang]['ui.add']}</span></button>
              </div>
            </div>
          </div>`;
        grid.appendChild(card);
      }
      applyReveal();
    }

    // ===== Cart logic (как раньше) =====
    let cart = [];
    const updateBadge = ()=> { const b = $('#cartCount'); if(b) b.textContent = cart.reduce((s,i)=>s+i.qty,0); };
    const openDrawer = ()=> {const d=$('#drawer'); d.setAttribute('aria-open','true'); d.removeAttribute('aria-hidden');}
    const closeDrawer = ()=> {const d=$('#drawer'); d.setAttribute('aria-open','false'); d.setAttribute('aria-hidden','true');}

    function addToCart(id){
      const prod = P.find(p=>p.id==id); if(!prod) return;
      const it = cart.find(i=>i.id==id);
      if(it) it.qty++; else cart.push({id:prod.id, qty:1});
      persist(); renderCart();
    }
    function changeQty(id,delta){
      const it = cart.find(i=>i.id==id); if(!it) return;
      it.qty += delta; if(it.qty<=0) cart = cart.filter(i=>i.id!=id);
      persist(); renderCart();
    }
    function clearCart(){ cart=[]; persist(); renderCart(); }
    function persist(){ localStorage.setItem('eco_cart', JSON.stringify(cart)); }
    function restore(){ try{ cart = JSON.parse(localStorage.getItem('eco_cart')||'[]') }catch{ cart=[] } }

    function renderCart(){
      updateBadge();
      const lang = document.documentElement.lang || 'ru';
      const box = $('#cartItems');
      if(!box) return;
      if(cart.length===0){ box.innerHTML = `<p class="muted">${ lang==='en' ? 'Your cart is empty' : (lang==='ky'?'Себет бош':'Корзина пуста') }</p>`; $('#cartTotal').textContent = fmt(0); return }
      let total = 0;
      box.innerHTML = cart.map(it=>{
        const p = P.find(x=>x.id==it.id); const sum = p.price*it.qty; total+=sum;
        return `<div class="cart-item">
          <img src="${p.img}" alt="${p.name[document.documentElement.lang||'ru']}">
          <div>
            <div class="name">${p.name[document.documentElement.lang||'ru']}</div>
            <div class="muted">${fmt(p.price)} × ${it.qty} = ${fmt(sum)}</div>
            <div class="qty" style="margin-top:.4rem">
              <button data-dec="${p.id}">−</button>
              <span>${it.qty}</span>
              <button data-inc="${p.id}">+</button>
              <button data-del="${p.id}" style="margin-left:.5rem">🗑</button>
            </div>
          </div>
          <div style="font-weight:700">${fmt(sum)}</div>
        </div>`
      }).join('');
      $('#cartTotal').textContent = fmt(total);
    }

    // ===== Telegram send (оставил как у вас) =====
    const TG_BOT_TOKEN = '7850919007:AAEomvefxyhlD8jOFgqDRuoyTYZTVoOGVew';
    const TG_CHAT_ID = '1043911649';
    const PROXY_URL = ''; // рекомендую настроить прокси (Cloudflare Worker) — пояснения в комментариях старого файла

    async function sendToTelegram(text){
      if(PROXY_URL){
        const r = await fetch(PROXY_URL, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({text})});
        if(!r.ok) throw new Error('Proxy error');
        return true;
      } else {
        const url = `https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage?chat_id=${encodeURIComponent(TG_CHAT_ID)}&parse_mode=HTML&text=${encodeURIComponent(text)}`;
        const r = await fetch(url, {method:'GET'});
        if(!r.ok) throw new Error('Telegram error');
        return true;
      }
    }

    $('#orderForm')?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(cart.length===0){ alert('Сначала добавьте товары в корзину'); return }
      const lang = document.documentElement.lang || 'ru';
      const name = $('#name').value.trim();
      const phone = $('#phone').value.trim();
      const address = $('#address').value.trim();
      const comment = $('#comment').value.trim();
      const pay = document.querySelector('input[name="pay"]:checked')?.value || 'MBank';
      let total = 0;
      const lines = cart.map(it=>{ const p=P.find(x=>x.id==it.id); const sum=p.price*it.qty; total+=sum; return `• ${p.name[lang]} — ${it.qty} × ${p.price} = ${sum} KGS`;});
      const msg = `<b>Новый заказ с сайта Эко-Нан</b>%0A%0A`+
        lines.join('%0A')+`%0A<b>Итого:</b> ${total} KGS%0A%0A`+
        `<b>Имя:</b> ${name}%0A<b>Телефон:</b> ${phone}%0A<b>Оплата:</b> ${pay}%0A<b>Адрес/самовывоз:</b> ${address||'-'}%0A<b>Комментарий:</b> ${comment||'-'}%0A`+
        `%0AИсточник: ${location.href}`;
      try{
        await sendToTelegram(decodeURIComponent(msg));
        alert(lang==='en' ? 'Order sent! We will contact you.' : (lang==='ky'?'Заказ жөнөтүлдү! Байланышабыз.':'Заявка отправлена! Мы свяжемся с вами.'));
        clearCart(); e.target.reset();
      }catch(err){
        console.error(err);
        alert('Не удалось отправить в Telegram. Проверьте настройки токена/прокси.');
      }
    });

    // ===== Click handlers (modal + cart) =====
    document.addEventListener('click', (e)=>{
      const ing = e.target.closest('[data-ingredients]');
      if(ing){ openCompositionModal(+ing.getAttribute('data-ingredients')); return; }

      const add = e.target.closest('[data-add]') || e.target.closest('.add-btn[data-add]');
      if(add){ addToCart(+add.getAttribute('data-add')); openDrawer(); return; }

      const inc = e.target.closest('[data-inc]'); if(inc) changeQty(+inc.getAttribute('data-inc'), +1);
      const dec = e.target.closest('[data-dec]'); if(dec) changeQty(+dec.getAttribute('data-dec'), -1);
      const del = e.target.closest('[data-del]'); if(del){ changeQty(+del.getAttribute('data-del'), -9999); }
    });

    $('#openCart')?.addEventListener('click', openDrawer);
    $('#closeCart')?.addEventListener('click', closeDrawer);
    $('#xClose')?.addEventListener('click', closeDrawer);
    $('#clearCart')?.addEventListener('click', clearCart);
    $('#toCheckout')?.addEventListener('click', closeDrawer);

    // nav drawer
    const openNav = ()=> {const d=$('#navDrawer'); d.setAttribute('aria-open','true'); d.removeAttribute('aria-hidden');}
    const closeNav = ()=> {const d=$('#navDrawer'); d.setAttribute('aria-open','false'); d.setAttribute('aria-hidden','true');}
    $('#openNav')?.addEventListener('click', openNav);
    $('#closeNav')?.addEventListener('click', closeNav);
    $('#xNav')?.addEventListener('click', closeNav);
    $$('.mnav').forEach(a=> a.addEventListener('click', closeNav));

    // reveal
    const io = new IntersectionObserver((entries)=> entries.forEach(en=>{ if(en.isIntersecting) en.target.classList.add('show') }), {threshold:.12});
    function applyReveal(){ $$('.reveal').forEach(el=> io.observe(el)); }

    // ===== Modal (composition) logic =====
    const modal = $('#modal');
    const modalOverlay = $('#modalOverlay');
    const modalClose = $('#modalClose');
    const modalCloseBtn = $('#modalCloseBtn');
    const modalImg = $('#modalImg');
    const modalTitle = $('#modalTitle');
    const modalDesc = $('#modalDesc');
    const modalAdd = $('#modalAdd');
    let modalOpen = false;
    let modalCurrentId = null;
    let lastFocusedBeforeModal = null;

    function openModal(){
      if(!modal) return;
      modal.setAttribute('aria-open','true'); modal.removeAttribute('aria-hidden');
      document.body.style.overflow = 'hidden';
      modalOpen = true;
      lastFocusedBeforeModal = document.activeElement;
      setTimeout(()=> modalClose.focus(), 60);
    }
    function closeModal(){
      if(!modal) return;
      modal.setAttribute('aria-open','false'); modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      modalOpen = false;
      modalCurrentId = null;
      if(lastFocusedBeforeModal) lastFocusedBeforeModal.focus();
    }

    function openCompositionModal(id){
      const prod = P.find(p=>p.id==id); if(!prod) return;
      modalCurrentId = id;
      const lang = document.documentElement.lang || 'ru';
      modalImg.src = prod.img;
      modalImg.alt = prod.name[lang];
      modalTitle.textContent = prod.name[lang] + ' — ' + fmt(prod.price);

      let raw = (prod.comp && prod.comp[lang]) ? prod.comp[lang] : '';
      const lines = raw.split('\n').map(s=>s.trim()).filter(Boolean);
      let html = '';
      if(lines.length){
        if(/^\d+\s?г/i.test(lines[0])){
          html += `<p style="margin:0 0.6rem;font-weight:700">${lines[0]}</p>`;
          const rest = lines.slice(1);
          if(rest.length){ html += `<div style="margin-top:8px">`; rest.forEach(r=> html += `<p style="margin:0 0.4rem;color:var(--muted)">${r}</p>`); html += `</div>`; }
        } else {
          lines.forEach(r=> html += `<p style="margin:0 0.4rem;color:var(--muted)">${r}</p>`);
        }
      } else {
        html = `<p style="margin:0;color:var(--muted)">${ document.documentElement.lang==='en' ? 'Composition not specified' : (document.documentElement.lang==='ky' ? 'Курамы такталган эмес' : 'Состав уточняется') }</p>`;
      }
      modalDesc.innerHTML = html;
      openModal();
    }

    modalOverlay?.addEventListener('click', closeModal);
    modalClose?.addEventListener('click', closeModal);
    modalCloseBtn?.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=> { if(e.key==='Escape' && modalOpen) closeModal(); });

    modalAdd?.addEventListener('click', ()=>{
      if(modalCurrentId) addToCart(modalCurrentId);
      closeModal();
      openDrawer();
    });

    // ===== STORES + MAP (we geocode addresses at runtime via Nominatim) =====
    // The exact addresses you provided (from 2GIS):
    const storeAddresses = [
      'улица Фрунзе, 605а, Бишкек',
      'улица Гагарина, 139ж, Бишкек',
      'микрорайон Джал Артис, 202/1, Бишкек',
      'микрорайон Джал-29, 20а, Бишкек',
      'проспект Чынгыза Айтматова, 100/7, Бишкек',
      'улица Фрунзе, 164, Бишкек',
      'улица Якова Логвиненко, 12/116, Бишкек',
      'улица Бугу-Эне, 60а, Бишкек',
      'улица Бакаева, 142, Бишкек',
      '7-й микрорайон, 5е, Бишкек',
      '7-й микрорайон, 52/2, Бишкек',
      'улица Сыдыкова, 156, Бишкек'
    ];

    // init map + geocode each address using Nominatim (OpenStreetMap)
    function initMapWithMarkers(){
      if(typeof L === 'undefined'){ const el = document.getElementById('map'); if(el) el.innerHTML = '<div style="padding:18px;color:#666">Ошибка: карта не загружена (Leaflet не найден).</div>'; console.error('Leaflet missing'); return; }

      const map = L.map('map').setView([42.8746, 74.5698], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap' }).addTo(map);

      const markers = [];
      const bounds = [];
      const listEl = $('#addrList'); if(listEl) listEl.innerHTML = '';

      // Nominatim base
      const base = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&q=';

      // do sequential requests with small delay (avoid rate-limit)
      storeAddresses.forEach((addr, idx) => {
        setTimeout(async () => {
          try {
            const q = encodeURIComponent(addr + ', Кыргызстан');
            const res = await fetch(base + q, { headers: { 'Accept-Language': 'ru' }});
            if(!res.ok) throw new Error('Geocode error');
            const data = await res.json();
            if(data && data.length){
              const lat = parseFloat(data[0].lat);
              const lon = parseFloat(data[0].lon);
              const marker = L.marker([lat, lon]).addTo(map).bindPopup(`<b>${addr}</b>`);
              markers.push(marker); bounds.push([lat, lon]);
              // add to list
              if(listEl){
                const li = document.createElement('li');
                li.textContent = addr;
                li.style.cursor = 'pointer';
                li.style.marginBottom = '6px';
                li.addEventListener('click', ()=> { map.setView([lat, lon], 16); marker.openPopup(); });
                listEl.appendChild(li);
              }
            } else {
              console.warn('Geocode empty for', addr);
              // fallback: add to list with note
              if(listEl){
                const li = document.createElement('li');
                li.textContent = addr + ' (координаты не найдены)';
                li.style.marginBottom = '6px';
                listEl.appendChild(li);
              }
            }
          } catch (err){
            console.error('Geocode failed for', addr, err);
            if(listEl){
              const li = document.createElement('li');
              li.textContent = addr + ' (ошибка геокодирования)';
              li.style.marginBottom = '6px';
              listEl.appendChild(li);
            }
          } finally {
            // after last -> fit bounds
            if(idx === storeAddresses.length - 1){
              if(bounds.length) map.fitBounds(bounds, {padding:[30,30]});
            }
          }
        }, idx * 300); // 300ms interval between requests
      });

      // fallback control: when nothing placed, center on Bishkek
      setTimeout(()=> {
        if(bounds.length===0) map.setView([42.8746, 74.5698], 12);
      }, storeAddresses.length * 320 + 500);
    }

    // ===== Init =====
    (function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      setLang('ru');
      renderMenu();
      restore();
      renderCart();
      applyReveal();
      initMapWithMarkers();
    })();
  </script>
</body>
</html>
